{% extends "base.html" %}

{% block title %}Remediation Plan - GDPR Compliance Dashboard{% endblock %}

{% block content %}
<div class="mb-lg">
    <nav style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
        <a href="{{ url_for('violation_detail', analysis_id=analysis_id, violation_index=violation_index) }}" style="color: var(--link-color);">
            <i class="fas fa-arrow-left"></i> Back to Violation Details
        </a>
    </nav>
    
    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: var(--spacing-sm);">
        <i class="fas fa-tools"></i>
        Remediation Plan
    </h1>
    <p style="color: var(--text-secondary);">{{ violation.category }}</p>
</div>

{% if violation.remediation %}
<!-- Priority & Effort -->
<div class="card mb-xl">
    <div class="grid grid-4">
        <div class="text-center">
            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Priority</div>
            <div class="badge badge-{{ violation.remediation.priority|lower }}" style="font-size: 1rem; padding: var(--spacing-sm) var(--spacing-lg);">
                {{ violation.remediation.priority }}
            </div>
        </div>
        <div class="text-center">
            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Complexity</div>
            <div style="font-weight: 600;">{{ violation.remediation.complexity }}</div>
        </div>
        <div class="text-center">
            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Estimated Effort</div>
            <div style="font-weight: 600;">{{ violation.remediation.estimated_effort }}</div>
        </div>
        <div class="text-center">
            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">Estimated Cost</div>
            <div style="font-weight: 600; color: var(--color-high);">{{ violation.remediation.estimated_cost }}</div>
        </div>
    </div>
</div>

<!-- Immediate Actions -->
<div class="card mb-lg">
    <h2 class="card-title">
        <i class="fas fa-exclamation-circle" style="color: var(--color-critical);"></i>
        Immediate Actions (0-7 days)
    </h2>
    <ul style="list-style: none; padding: 0;">
        {% for action in violation.remediation.immediate_actions %}
        <li style="padding: var(--spacing-md); background: var(--bg-primary); margin-bottom: var(--spacing-sm); border-radius: var(--radius-md); border-left: 4px solid var(--color-critical);">
            {{ action }}
        </li>
        {% endfor %}
    </ul>
</div>

<!-- Short-Term Solutions -->
<div class="card mb-lg">
    <h2 class="card-title">
        <i class="fas fa-clock" style="color: var(--color-high);"></i>
        Short-Term Solutions (1-3 months)
    </h2>
    <ul style="list-style: none; padding: 0;">
        {% for solution in violation.remediation.short_term_solutions %}
        <li style="padding: var(--spacing-md); background: var(--bg-primary); margin-bottom: var(--spacing-sm); border-radius: var(--radius-md); border-left: 4px solid var(--color-high);">
            {{ solution }}
        </li>
        {% endfor %}
    </ul>
</div>

<!-- Long-Term Improvements -->
<div class="card mb-lg">
    <h2 class="card-title">
        <i class="fas fa-flag" style="color: var(--color-success);"></i>
        Long-Term Improvements (3-6 months)
    </h2>
    <ul style="list-style: none; padding: 0;">
        {% for improvement in violation.remediation.long_term_improvements %}
        <li style="padding: var(--spacing-md); background: var(--bg-primary); margin-bottom: var(--spacing-sm); border-radius: var(--radius-md); border-left: 4px solid var(--color-success);">
            {{ improvement }}
        </li>
        {% endfor %}
    </ul>
</div>

<!-- Implementation Steps -->
{% if violation.remediation.detailed_steps %}
<div class="card mb-lg">
    <h2 class="card-title">
        <i class="fas fa-list-ol"></i>
        Implementation Steps
    </h2>
    {% for step in violation.remediation.detailed_steps %}
    <div style="background: var(--bg-primary); padding: var(--spacing-lg); margin-bottom: var(--spacing-md); border-radius: var(--radius-md); border: 1px solid var(--border-color);">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
            <h3 style="font-weight: 600; color: var(--text-primary);">
                Step {{ step.step_number }}: {{ step.action[:100] }}{% if step.action|length > 100 %}...{% endif %}
            </h3>
        </div>
        <div class="grid grid-3 gap-md mt-md">
            <div>
                <div style="color: var(--text-secondary); font-size: 0.85rem;">Owner</div>
                <div style="font-weight: 600;">{{ step.owner }}</div>
            </div>
            <div>
                <div style="color: var(--text-secondary); font-size: 0.85rem;">Timeline</div>
                <div style="font-weight: 600;">{{ step.timeline }}</div>
            </div>
            <div>
                <div style="color: var(--text-secondary); font-size: 0.85rem;">Resources</div>
                <div style="font-weight: 600;">{{ step.resources_needed[0] if step.resources_needed else 'TBD' }}</div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Required Roles -->
{% if violation.remediation.required_roles %}
<div class="card">
    <h2 class="card-title">
        <i class="fas fa-users"></i>
        Required Roles
    </h2>
    <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-sm);">
        {% for role in violation.remediation.required_roles %}
        <span class="badge badge-info" style="font-size: 0.9rem; padding: var(--spacing-sm) var(--spacing-md);">
            {{ role }}
        </span>
        {% endfor %}
    </div>
</div>
{% endif %}

{% else %}
<div class="card text-center">
    <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--color-high); margin-bottom: var(--spacing-md);"></i>
    <h2>No Remediation Available</h2>
    <p style="color: var(--text-secondary);">Remediation guidance could not be generated for this violation.</p>
</div>
{% endif %}
{% endblock %}
