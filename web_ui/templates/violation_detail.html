{% extends "base.html" %}

{% block title %}Violation Details - GDPR Compliance Dashboard{% endblock %}

{% block content %}
<div class="mb-lg">
    <nav style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
        <a href="{{ url_for('results_page', analysis_id=analysis_id) }}" style="color: var(--link-color);">
            <i class="fas fa-arrow-left"></i> Back to Results
        </a>
    </nav>
    
    <h1 style="font-size: 2rem; font-weight: 700;">
        {{ violation.category }}
        <span class="badge badge-{{ violation.severity|lower }}">{{ violation.severity }}</span>
    </h1>
</div>

<div class="grid grid-3 gap-lg">
    <!-- Left Column: Quick Info -->
    <div class="card">
        <h2 class="card-title">Quick Info</h2>
        <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
            <div>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">
                    Articles
                </div>
                <div class="articles-chips">
                    {% for article in violation.articles %}
                    <span class="badge badge-info">{{ article }}</span>
                    {% endfor %}
                </div>
            </div>
            
            <div>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">
                    Risk Score
                </div>
                <div style="font-size: 1.8rem; font-weight: 700; color: var(--color-critical);">
                    {{ violation.risk_score }}/10
                </div>
            </div>
            
            {% if violation.remediation %}
            <div>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">
                    Estimated Cost
                </div>
                <div style="font-weight: 600;">{{ violation.remediation.estimated_cost }}</div>
            </div>
            
            <div>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: var(--spacing-xs);">
                    Timeline
                </div>
                <div style="font-weight: 600;">{{ violation.remediation.estimated_effort }}</div>
            </div>
            {% endif %}
        </div>
        
        <a href="{{ url_for('remediation_page', analysis_id=analysis_id, violation_index=violation_index) }}" 
           class="btn btn-primary mt-lg" style="width: 100%;">
            <i class="fas fa-tools"></i>
            View Remediation Plan
        </a>
    </div>
    
    <!-- Center Column: Violation Analysis -->
    <div style="grid-column: span 2;">
        <div class="card mb-lg">
            <h2 class="card-title">Problematic Text</h2>
            <div class="problematic-text">
                {{ violation.problematic_text }}
            </div>
        </div>
        
        <div class="card mb-lg">
            <h2 class="card-title">Description</h2>
            <p style="color: var(--text-secondary); line-height: 1.8;">
                {{ violation.evidence }}
            </p>
        </div>
        
        {% if violation.reference %}
        <div class="card">
            <h2 class="card-title">GDPR Reference</h2>
            <div style="background: var(--bg-primary); padding: var(--spacing-lg); border-radius: var(--radius-md); color: var(--text-secondary); line-height: 1.8;">
                {{ violation.reference }}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<style>
    .problematic-text {
        background: var(--bg-primary);
        padding: var(--spacing-lg);
        border-radius: var(--radius-md);
        border-left: 4px solid var(--color-critical);
        font-style: italic;
        color: var(--text-secondary);
    }
    
    .articles-chips {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-xs);
    }
</style>
{% endblock %}
